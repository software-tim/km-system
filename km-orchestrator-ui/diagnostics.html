<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM Orchestrator - System Diagnostics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .diagnostic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .diagnostic-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .diagnostic-card h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .test-button:hover {
            background: #5a67d8;
        }

        .test-button.working {
            background: #10b981;
        }

        .test-button.broken {
            background: #ef4444;
        }

        .test-response {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .endpoint-test {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .endpoint-path {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .refresh-all {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .refresh-all:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 KM Orchestrator System Diagnostics</h1>
            <p>Comprehensive testing and monitoring of all orchestrator capabilities and underlying services</p>
        </div>

        <button class="refresh-all" onclick="runAllDiagnostics()">🔄 Run All Diagnostics</button>

        <div class="diagnostic-grid">
            <!-- Orchestrator Core Functions -->
            <div class="diagnostic-card">
                <h3>🎯 Orchestrator Core Functions</h3>
                <div class="endpoint-test">
                    <div class="endpoint-path">GET /health</div>
                    <button class="test-button" onclick="testEndpoint('/health', 'health-result')">Test Health Check</button>
                    <div class="test-response" id="health-result">Click test to check...</div>
                </div>
                <div class="endpoint-test">
                    <div class="endpoint-path">GET /services/status</div>
                    <button class="test-button" onclick="testEndpoint('/services/status', 'services-result')">Test Services Status</button>
                    <div class="test-response" id="services-result">Click test to check...</div>
                </div>
                <div class="endpoint-test">
                    <div class="endpoint-path">POST /api/chat</div>
                    <button class="test-button" onclick="testChat('orchestrator-chat-result')">Test Chat Function</button>
                    <div class="test-response" id="orchestrator-chat-result">Click test to check...</div>
                </div>
            </div>

            <!-- Test Results -->
            <div class="diagnostic-card">
                <h3>📊 Test Results</h3>
                <div class="endpoint-test">
                    <div class="endpoint-path">Working: <span id="working-count">0</span></div>
                    <div class="endpoint-path">Broken: <span id="broken-count">0</span></div>
                    <div class="endpoint-path">Total: <span id="total-count">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};

        async function testEndpoint(endpoint, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.textContent = 'Testing...';
            
            try {
                const response = await fetch(endpoint);
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                markTestResult(resultId, 'working');
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                markTestResult(resultId, 'broken');
            }
        }

        async function testChat(resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.textContent = 'Testing chat...';
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'test query for diagnostics' })
                });
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                markTestResult(resultId, data.status === 'error' ? 'broken' : 'working');
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                markTestResult(resultId, 'broken');
            }
        }

        function markTestResult(testId, status) {
            testResults[testId] = status;
            const button = document.querySelector(`button[onclick*="${testId}"]`);
            if (button) {
                button.className = `test-button ${status}`;
            }
            updateSummary();
        }

        function updateSummary() {
            const working = Object.values(testResults).filter(r => r === 'working').length;
            const broken = Object.values(testResults).filter(r => r === 'broken').length;
            const total = Object.values(testResults).length;

            document.getElementById('working-count').textContent = working;
            document.getElementById('broken-count').textContent = broken;
            document.getElementById('total-count').textContent = total;
        }

        async function runAllDiagnostics() {
            const tests = [
                () => testEndpoint('/health', 'health-result'),
                () => testEndpoint('/services/status', 'services-result'),
                () => testChat('orchestrator-chat-result')
            ];

            for (let i = 0; i < tests.length; i++) {
                tests[i]();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        console.log('🎯 Diagnostics ready!');
    </script>
</body>
</html>
